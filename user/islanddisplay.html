<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂèÉËßÄÂ≥∂Â∂º</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <link rel="icon" type="image/svg" href="https://lh3.googleusercontent.com/d/1x9g9cC2Z3YOQXjplPElgLOtBuKixb6lD">
    <link rel="apple-touch-icon" href="https://lh3.googleusercontent.com/d/1UL5PytrCRj0UFA9yJ2QFKowmTmBw-rZn">
    <style>
    body, html {margin: 0; padding: 0; width: 100%; height: 100%; position: fixed;
                background: #1a1a1a; overflow: hidden; 
                display: flex; align-items: center; justify-content: center; 
                touch-action: none; overscroll-behavior: none; -webkit-user-select: none; -webkit-touch-callout: none; -webkit-user-drag: none;
                cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='50' height='50' style='font-size:36px'><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle'>‚òÅÔ∏è</text></svg>") 25 25, auto;
    }
        /* üñºÔ∏è 16:9 Â§ñÊ°Ü FRAME */
        .swiper {width: 1280px; height: 720px; background: #000; position: relative; flex-shrink: 0; transform-origin: center center;}
        .island-stage {width: 100%; height: 100%; position: relative; background-size: 100% 100%; background-position: center;}
        /* üß∏ Áâ©‰ª∂ ITEMS */
        .draggable-display {position: absolute; transform: translate(-50%, -50%); pointer-events: none; touch-action: none;}
        .draggable-display img {width: 100%; display: block; pointer-events: none; touch-action: none;  -webkit-touch-callout: none; -webkit-user-drag: none; -webkit-user-select: none; -ms-user-select: none; -moz-user-select: none;}
        /* ‚û°Ô∏è ÁÆ≠ÂíÄ ARROWS */
        .swiper-button-next, .swiper-button-prev {color: #ffffff !important; border-radius: 50%; text-shadow: 0 0 10px rgba(0,0,0,0.3);}
        :root {--swiper-pagination-color: white;}
        @media (max-width: 768px) {.swiper-button-next::after, .swiper-button-prev::after {font-size: 25px !important;}}
        /* üîò ÊåâÈàï BUTTONS */
        .glass-button {z-index: 9999; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); color: #64748B;
                      padding: 12px; border-radius: 50px; display: flex; align-items: center; gap: 8px;
                      font-size: 16px; cursor: pointer; transition: all 0.2s ease;}
        .glass-button:hover {background-color: rgba(255, 255, 255, 0.2); color: rgba(255, 255, 255, 1);}
        .glass-button:active {background-color: rgba(255, 255, 255, 0.3); color: rgba(255, 255, 255, 1); transform: scale(0.95);}
        @media (max-height: 450px) {.glass-button {top: 10px; left: 10px; padding: 12px 12px; font-size: 14px;}}
        a, .swiper-button-next, .swiper-button-prev {cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='55' height='55' style='font-size:40px; opacity:0.8'><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle'>üå•Ô∏è</text></svg>") 27 27, pointer !important;}
    </style>
</head>
<body>
    <a href="island.html" class="glass-button fixed left-[40px] top-[20px]" draggable="false" title="Ë®≠ÂÆöÊ®°Âºè">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tree-palm-icon lucide-tree-palm"><path d="M13 8c0-2.76-2.46-5-5.5-5S2 5.24 2 8h2l1-1 1 1h4"/><path d="M13 7.14A5.82 5.82 0 0 1 16.5 6c3.04 0 5.5 2.24 5.5 5h-3l-1-1-1 1h-3"/><path d="M5.89 9.71c-2.15 2.15-2.3 5.47-.35 7.43l4.24-4.25.7-.7.71-.71 2.12-2.12c-1.95-1.96-5.27-1.8-7.42.35"/><path d="M11 15.5c.5 2.5-.17 4.5-1 6.5h4c2-5.5-.5-12-1-14"/></svg>
    </a>
    <a href="../index.html" class="glass-button fixed left-[20px] top-[20px]" draggable="false" title="ËøîÂõû‰∏ªÈ†Å">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-door-open-icon lucide-door-open"><path d="M11 20H2"/><path d="M11 4.562v16.157a1 1 0 0 0 1.242.97L19 20V5.562a2 2 0 0 0-1.515-1.94l-4-1A2 2 0 0 0 11 4.561z"/><path d="M11 4H8a2 2 0 0 0-2 2v14"/><path d="M14 12h.01"/><path d="M22 20h-3"/></svg>
    </a>
    <div class="swiper">
        <div class="swiper-wrapper" id="island-container"></div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyDz2hqa91CXeif-ZSCf1PFKj4ylM3xVfO3bRnW966NewXzdeiRBwuVuiMfMYGhTLQ4/exec";
        const params = new URLSearchParams(window.location.search);
        const user = params.get('user') || 'Testing';
        
        function getBackground(islandId) {
            const bgs = {
                'island_1': 'https://lh3.googleusercontent.com/d/1j_GFfezO8NNHnF1M-q7euOdDHOdtP8vF',
                'island_2': 'https://lh3.googleusercontent.com/d/1Roy33fghpQHRS1IZk2N_MxYbY1-YKVRu',
                'island_3': 'https://lh3.googleusercontent.com/d/15OIBcHpnpYkV1hH4pk64qJjEon-y1plq',
            };
            return bgs[islandId] || bgs['island_1'];
        }
        
        function handleResize() {const swiperEl = document.querySelector('.swiper');
                                 const designWidth = 1280; const designHeight = 720;
                                 const windowWidth = window.innerWidth;const windowHeight = window.innerHeight;
                                 const scale = Math.min(windowWidth / designWidth, windowHeight / designHeight);
                                 swiperEl.style.transform = `scale(${scale})`;}
        window.addEventListener('resize', handleResize);
        window.addEventListener('load', handleResize);
        handleResize();

        
        async function init() {
                    try {
                        const res = await fetch(`${GAS_URL}?user=${encodeURIComponent(user)}`);
                        const islands = await res.json();
                        const container = document.getElementById('island-container');
                        islands.forEach(island => {
                            const slide = document.createElement('div');
                            slide.className = 'swiper-slide';
                            const stage = document.createElement('div');
                            stage.className = 'island-stage';
                            stage.style.backgroundImage = `url('${getBackground(island.islandId)}')`;
                            island.items.forEach(item => {
                                const div = document.createElement('div');
                                div.className = 'draggable-display';
                                let widthStr = String(item.width);
                                if (widthStr.includes('%')) {
                                    div.style.width = parseFloat(widthStr) + '%';
                                } else {
                                    const pxValue = parseFloat(widthStr) || 150;
                                    div.style.width = (pxValue / 1280 * 100) + '%';
                                }
                                div.style.left = item.leftPercent + '%';
                                div.style.top = item.topPercent + '%';
                                div.style.zIndex = item.isBottom ? "1" : "10";
                                div.innerHTML = `<img src="${item.url}">`;
                                stage.appendChild(div);
                            });
                            slide.appendChild(stage);
                            container.appendChild(slide);
                        });
                        new Swiper('.swiper', {
                            navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
                            pagination: { el: '.swiper-pagination', clickable: true },
                            on: {
                                resize: function () {
                                    this.update();
                                }
                            }
                        });
                    } catch (e) {
                        console.error("ËºâÂÖ•Â§±Êïó:", e);
                    }
                }

        init();

        // ü´µüèª ÊâãÂã¢Á¶ÅÊ≠¢ DISABLE GESTURE
            // Â§öÊåáÁ∏ÆÊîæ
            const preventZoom = (e) => {if (e.touches?.length > 1 || (e.type === 'wheel' && (e.ctrlKey || e.metaKey))) {if (e.cancelable) e.preventDefault();}};
            ['touchstart', 'wheel', 'gesturestart'].forEach(type => {document.addEventListener(type, preventZoom, {passive: false});});
            // ÈõôÊìäÁ∏ÆÊîæ
            let lastTouch = 0; document.addEventListener('touchend', (e) => {const now = Date.now(); if (now - lastTouch <= 300) e.preventDefault(); lastTouch = now;}, false);

    </script>
</body>
</html>
