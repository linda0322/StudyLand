<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>è³¼ç‰©ç´€éŒ„</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap">
    <link rel="icon" type="image/webp" href="https://lh3.googleusercontent.com/d/1dEOyNT7D5TQfiV0i2BbfLR6nQIcEylP1">
    <link rel="apple-touch-icon" href="https://lh3.googleusercontent.com/d/1cVkUL5LapuLvtBYyw_CHgejOCflFRYyB">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ğŸï¸ æ•´é«”ç‰ˆé¢ OVERALL */
        body {height: 100vh; width: 100vw; margin: 0; overflow: hidden; overscroll-behavior: none; font-family: 'Noto Sans TC', sans-serif; background-color: #1dc5fd;
              cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='50' height='50' style='font-size:36px'><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle'>â˜ï¸</text></svg>") 25 25, auto;}
            /* ğŸ™ï¸ èƒŒæ™¯å±¤ BACKGROUND LAYER */
            .bg-layer {position: fixed; inset: 0; z-index: -1;
                       background-size: cover; background-position: center center; background-repeat: no-repeat;
                       background-image: url('https://lh3.googleusercontent.com/d/1XB4PQJBN1OIo93GUSkfDm4T8TDSOBQg2');}
            /* ğŸ“± æ‰‹æ©ŸèƒŒæ™¯ PHONE BACKGROUND LAYER */
            @media screen and (max-width: 600px) {.bg-layer {background-size: 100% auto; background-position: center top; background-image: url('https://lh3.googleusercontent.com/d/1OZe9V17SD7onLwgnE2IDiPG2D9KBjqAA');}}
            /* ğŸ“± æ‰‹æ©Ÿæ—‹è½‰æç¤º ORIENTATION NOTI */
            #orientation-noti {display: none; position: fixed; inset: 0; z-index: 99999;
                               background-color: #1dc5fd;
                               flex-direction: column; align-items: center; justify-content: center;}
            @media screen and (max-width: 1000px) and (orientation: landscape) {#orientation-noti {display: flex !important;} body {overflow: hidden !important;}}
            @keyframes phone-portrait {0% { transform: rotate(-90deg); } 30% { transform: rotate(0deg); } 70% { transform: rotate(0deg); } 100% { transform: rotate(-90deg); }}
            .animate-phone-portrait {animation: phone-portrait 3s ease-in-out infinite; transform-origin: center;}
        
        /* ğŸŒ¼ æ¨£å¼ STYLE */
            /* ğŸ¥½ ç»ç’ƒæ¡† */
            .glass-panel {background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3);}
            /* ğŸ”  å­—é«” FONTS */
            @font-face {font-family: "Cubic11"; src: url('https://cdn.jsdelivr.net/gh/ACh-K/Cubic-11@90bc0e197c4db0fc8c75fe30c2d82dea03da707e/fonts/ttf/Cubic_11.ttf') format('truetype'); font-display: swap;}
            .font-cubic {font-family: 'Cubic11', sans-serif;}
            .thin-border {-webkit-text-stroke: 0.5px currentColor; paint-order: stroke fill;}
            .thick-border {-webkit-text-stroke: 1px currentColor; paint-order: stroke fill;}

        /* ğŸ• å‹•ç•« ANIMATION */
        @keyframes fadeInUp {from {opacity: 0; transform: translateY(20px);} to {opacity: 1; transform: translateY(0);}}
        .record-item {animation: fadeInUp 0.5s ease forwards; opacity: 0;}

        /* ğŸšï¸ æ²è»¸ SCROLLER */
        .custom-scrollbar::-webkit-scrollbar {width: 4px;}
        .custom-scrollbar::-webkit-scrollbar-track {background: transparent;}
        .custom-scrollbar::-webkit-scrollbar-thumb {background: rgba(255,255,255,0.4); border-radius: 10px;}
    </style>
</head>
<body>
    <!-- ğŸ™ï¸ èƒŒæ™¯åœ– BACKGROUND --><div class="bg-layer"></div>
    
    <!-- ğŸ“± æ‰‹æ©Ÿæ—‹è½‰æç¤º ORIENTATION NOTI -->
    <div id="orientation-noti">
        <div class="animate-phone-portrait w-20 h-20 flex items-center justify-center mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>
        </div>
        <h2 class="font-cubic text-xl text-white thick-border tracking-wider">æ—‹è½‰è¢å¹•ä»¥ç¹¼çºŒéŠæˆ²</h2>
    </div>

    <main class="flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-md h-[80vh] flex flex-col shadow-2xl overflow-hidden border border-white/40">
        <div class="p-6 pb-2">
            <h1 class="font-cubic text-3xl text-white thick-border mb-1">è³¼ç‰©æ¸…å–®</h1>
        </div>

        <div id="record-container" class="flex-1 overflow-y-auto p-6 pt-2 custom-scrollbar space-y-4">
            <div class="flex flex-col items-center justify-center h-full text-white/80 space-y-2">
                <div class="animate-spin text-3xl">ğŸŒ€</div>
                <p class="font-cubic">æ­£åœ¨ç¿»é–±å¸³æœ¬...</p>
            </div>
        </div>

        <div class="p-4 bg-white/10 text-center">
            <button onclick="window.location.href='downtown.html'" class="font-cubic text-white bg-white/20 hover:bg-white/30 px-6 py-2 rounded-full transition-all text-sm border border-white/20">
                è¿”å›åœ°åœ–
            </button>
        </div>
    </div>
    </main>

    <script>
        // ğŸŒ GAS
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwyk_UVjukSLRWYv22LwSegOm0_Q1ICMoHdtn9qA-T6jXmJ1UI_MKNWHk9EWBz2j9kz/exec";

        window.addEventListener('DOMContentLoaded', () => {const savedName = localStorage.getItem('studyLandUser');
                                                           if (!savedName) {window.location.href = 'index.html'; return;}
                                                           document.getElementById('user-display-name').textContent = savedName;
                                                           fetchHistory(savedName);});

        async function fetchHistory(username) {
            const container = document.getElementById('record-container');
            try {const response = await fetch(`${SCRIPT_URL}?user=${encodeURIComponent(username)}`);
                 const data = await response.json();
                 if (data.records && data.records.length > 0) {container.innerHTML = ''; data.records.forEach((item, index) => {
                        const card = document.createElement('div');
                        card.className = "record-item glass-panel bg-white/10 p-4 border border-white/20";
                        card.style.animationDelay = `${index * 0.1}s`;
                        card.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-cubic text-slate-500 text-lg">${item.itemName}</h3>
                                    <p class="font-cubic text-slate-300 text-xs mt-1">ğŸ“ ${item.location}</p>
                                </div>
                                <span class="bg-white text-slate-300 font-cubic text-sm rounded-lg shadow-sm px-3 py-1">x${item.quantity}</span>
                            </div>
                            <div class="mt-3 pt-2 border-t border-white/10 text-[10px] text-white text-right">${item.date}</div>
                            `;
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full text-white/60">
                            <span class="text-5xl mb-4">ğŸ“­</span>
                            <p class="font-cubic">ç›®å‰æ²’æœ‰ä»»ä½•è³¼ç‰©ç´€éŒ„</p>
                        </div>`;
                }
            } catch (error) {
                console.error('Fetch Error:', error);
                container.innerHTML = `
                    <div class="text-center text-red-100 p-4">
                        <p class="font-bold">é€£ç·šå¤±æ•— ğŸ›°ï¸</p>
                        <p class="text-xs opacity-70">è«‹ç¢ºèª GAS æ˜¯å¦å·²æ­£ç¢ºéƒ¨ç½²ä¸¦é–‹æ”¾æ¬Šé™</p>
                    </div>`;
            }
        }

        // ğŸ“± æ‰‹æ©Ÿæ—‹è½‰æç¤º ORIENTATION NOTI
        function handleOrientationChange() {const warning = document.getElementById('orientation-noti'); 
                                            const isPortrait = window.innerHeight > window.innerWidth; const isMobileOrTablet = window.innerWidth < 700;
                                            if (isPortrait && isMobileOrTablet) {warning.style.setProperty('display', 'flex', 'important');} else {warning.style.display = 'none';}}
        window.addEventListener('resize', handleOrientationChange);
        window.addEventListener('orientationchange', handleOrientationChange);
        handleOrientationChange();
    </script>
</body>
</html>
